<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>UDP: The “Thin Wrapper” - mahad@archives documentation</title><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Hardware" href="../hardware/index.html" /><link rel="prev" title="Logical Addressing (IPv4)" href="logical_addressing.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"dark");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=44020203" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=dc970a10" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="UDP: The “Thin Wrapper”"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../index.html">
      
      
      <strong>mahad@archives</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../../kernel/index.html">Kernel</a></li><li class="link"><a href="../../projects/index.html">Projects</a></li><li class="link"><a href="../../security/index.html">Security</a></li><li class="link"><a href="../index.html">Journal</a></li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/Mahad-Ibrahim" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Navigation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Kernel Space</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../kernel/Logs.html">Upstream Contributions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/index.html">Engineering Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../projects/tartarus_gate/index.html">Project Tartarus: Advanced Windows Implant Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../projects/mini_siem/index.html">Mini SIEM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security &amp; Malware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../security/evasion/index.html">Evasion Research</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/evasion/intro.html">EDR Evasion Intro</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../security/reversing/index.html">Reverse Engineering</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../security/reversing/ghidra_setup.html">Ghidra Workflow</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Journal</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Networking</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="data_link_and_flow_control.html">Data Link Control &amp; Flow Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="logical_addressing.html">Logical Addressing (IPv4)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">UDP: The “Thin Wrapper”</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/index.html">Hardware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../hardware/8086.html">8086 Architecture: The Split Logic</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#the-c-struct-definition">The C Struct Definition</a></li>
<li><a class="reference internal" href="#deep-dive-the-pseudo-header">Deep Dive: The &#8220;Pseudo-Header&#8221;</a><ul>
<li><a class="reference internal" href="#the-solution-virtual-verification">The Solution: Virtual Verification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-sealed-envelope-end-to-end-principle">The Sealed Envelope (End-to-End Principle)</a><ul>
<li><a class="reference internal" href="#link-a-router">Link A-Router</a></li>
<li><a class="reference internal" href="#inside-the-router-the-danger-zone">Inside the Router (The Danger Zone)</a></li>
<li><a class="reference internal" href="#link-router-b">Link Router-B</a></li>
<li><a class="reference internal" href="#the-solution">The Solution</a></li>
</ul>
</li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">mahad@archives</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Journal</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Networking</span></a>
        <span>/</span>
        <meta itemprop="position" content="3" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">UDP: The “Thin Wrapper”</strong>
        <meta itemprop="position" content="4" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <article class="yue" role="main">
          <section id="udp-the-thin-wrapper">
<h1>UDP: The “Thin Wrapper”<a class="headerlink" href="#udp-the-thin-wrapper" title="Link to this heading">¶</a></h1>
<p>Inside the OS, a UDP packet is just an IP address with a port number. That is literally what it can be reduced to. It does not care about accuracy, and it is used when <em>“I just need this data sent fast. I don’t care if it’s 100% accurate.”</em></p>
<p><strong>UDP is a connectionless protocol.</strong>
What does connectionless mean? It means the OS does not keep track of it at all. It just sends the packet and forgets about it.
“Did it arrive okay?” The OS does not care.
“Maybe I should ACK back to the sender’s UDP packet to tell him I got it.” The OS <em>does not care.</em></p>
<section id="the-c-struct-definition">
<h2>The C Struct Definition<a class="headerlink" href="#the-c-struct-definition" title="Link to this heading">¶</a></h2>
<p>This is located inside of <code class="docutils literal notranslate"><span class="pre">netinet/udp.h</span></code>, and it looks like:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">struct</span><span class="w"> </span><span class="nc">udphdr</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">source</span><span class="p">;</span><span class="w">  </span><span class="c1">// Source Port</span>
</span><span data-line="3"><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">dest</span><span class="p">;</span><span class="w">    </span><span class="c1">// Destination Port</span>
</span><span data-line="4"><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w">     </span><span class="c1">// Length (Header + Data)</span>
</span><span data-line="5"><span class="w">    </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">check</span><span class="p">;</span><span class="w">   </span><span class="c1">// Checksum</span>
</span><span data-line="6"><span class="p">};</span>
</span></pre></div>
</div>
<ol class="arabic simple">
<li><p><strong>Source Address:</strong> Optional. It can be empty just if you just want to “Throw” a packet out i.e one-way broadcast.</p></li>
<li><p><strong>Destination Address:</strong> Required. You need to put the Port of the place you want to send the packet to.</p></li>
<li><p><strong>Length:</strong> Required. The total size (Header + Payload). Minimum is 8 bytes, just the header.</p></li>
<li><p><strong>Checksum:</strong> Optional in IPv4. Mandatory in IPv6. It checks for bit errors “Noise”. Not lost packets.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="deep-dive-the-pseudo-header">
<h2>Deep Dive: The “Pseudo-Header”<a class="headerlink" href="#deep-dive-the-pseudo-header" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>The OSI model demands strict separation:</dt><dd><ul class="simple">
<li><p><strong>IP (Layer 3)</strong> handles Source/Dest IP Addresses.</p></li>
<li><p><strong>UDP/TCP (Layer 4)</strong> handles Source/Dest Ports.</p></li>
</ul>
</dd>
</dl>
<p><strong>The Problem:</strong> Imagine a buggy router. It receives a UDP packet meant for <code class="docutils literal notranslate"><span class="pre">192.168.1.5</span></code> but accidentally forwards it to <code class="docutils literal notranslate"><span class="pre">192.168.1.99</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>The <strong>IP Layer</strong> at .99 accepts it (because it just looks at the bits).</p></li>
<li><p>The <strong>UDP Layer</strong> at .99 looks at the port (e.g., Port 80). If .99 happens to have a web server running, it accepts the packet.</p></li>
</ul>
</div></blockquote>
<p><strong>Result:</strong> You just injected garbage data into the wrong server because UDP/TCP usually don’t look at IP addresses.</p>
<section id="the-solution-virtual-verification">
<h3>The Solution: Virtual Verification<a class="headerlink" href="#the-solution-virtual-verification" title="Link to this heading">¶</a></h3>
<p>To prevent this, a <strong>“Pseudo-Header”</strong> is created by the OS. The Transport Layer MUST verify the IP address, even though it’s “not its job.”
The Solution: Virtual Verification
———————————-</p>
<p>To prevent this, a <strong>“Pseudo-Header”</strong> is created by the OS. The Transport Layer MUST verify the IP address, even though it’s “not its job.”</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>KERNEL MEMORY SNAPSHOT (RAM ONLY)</p>
<p>The Kernel builds a temporary struct in the CPU registers. It contains the <strong>IP Addresses</strong> borrowed from Layer 3.</p>
<p><strong>Visualizing the 12-Byte Virtual Structure:</strong></p>
<div class="highlight-text notranslate" id="pseudo-header-map"><div class="highlight"><pre><span></span><span data-line="1">  0      7 8     15 16    23 24    31
</span><span data-line="2"> +--------+--------+--------+--------+
</span><span data-line="3"> |          Source IP Address        |  &lt;-- 4 Bytes (Layer 3)
</span><span data-line="4"> +--------+--------+--------+--------+
</span><span data-line="5"> |       Destination IP Address      |  &lt;-- 4 Bytes (Layer 3)
</span><span data-line="6"> +--------+--------+--------+--------+
</span><span data-line="7"> |  ZERO  | Proto  |   UDP Length    |  &lt;-- 4 Bytes (Meta)
</span><span data-line="8"> +--------+--------+--------+--------+
</span><span data-line="9">          ^        ^
</span><span data-line="10">          |        |
</span><span data-line="11">   Padding (0)   Protocol 17 (UDP)
</span></pre></div>
</div>
<p>The Checksum is calculated over this <strong>Virtual Header + Real Header + Data</strong>. If the IP is wrong, the Checksum fails.</p>
</div>
</section>
</section>
<hr class="docutils" />
<section id="the-sealed-envelope-end-to-end-principle">
<h2>The Sealed Envelope (End-to-End Principle)<a class="headerlink" href="#the-sealed-envelope-end-to-end-principle" title="Link to this heading">¶</a></h2>
<p>If we already have a checksum on the Ethernet Layer (Data Link Layer), why do we need <em>another</em> Checksum on the UDP layer (Network Layer)?</p>
<p>It seems redundant, you have a checksum which validates the data on the lower layers already, why would you need to do it again on the higher layers?</p>
<p>It comes down to one core difference. <strong>Ethernet (Data Link) Layer’s CRC is Hop-to-Hop, UDP (Network) Layer’s checksum is End-to-End.</strong> This is the one difference that makes it important, and it is a very intelligent design.</p>
<p>Imagine a packet traveling from <strong>A → Router → B</strong>.</p>
<section id="link-a-router">
<h3>Link A-Router<a class="headerlink" href="#link-a-router" title="Link to this heading">¶</a></h3>
<p>Data is valid on the wire. Ethernet CRC passes.
The Router accepts the packet into its RAM.</p>
</section>
<section id="inside-the-router-the-danger-zone">
<h3>Inside the Router (The Danger Zone)<a class="headerlink" href="#inside-the-router-the-danger-zone" title="Link to this heading">¶</a></h3>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>THE NAKED PACKET</p>
<p><strong>CRITICAL:</strong> The Router strips off the Ethernet Header (and the CRC). The packet sits <strong>naked</strong> in the Router’s RAM buffer.</p>
<p><strong>Scenario:</strong> The Router has a bad RAM stick. A single bit flips inside the packet payload while it is waiting in the queue.</p>
<p>The Router builds a <em>new</em> Ethernet frame for the next hop. It calculates a <em>new</em> Ethernet CRC based on the <strong>now-corrupted data</strong>.</p>
</div>
</section>
<section id="link-router-b">
<h3>Link Router-B<a class="headerlink" href="#link-router-b" title="Link to this heading">¶</a></h3>
<p>The packet is sent to B.
B receives it. The Ethernet CRC <strong>PASSES</strong> (because it matches the corrupted data sent by the router).</p>
<p><strong>Result:</strong> Without the UDP Checksum, you just received a corrupted file, and the network told you it was perfect.</p>
</section>
<section id="the-solution">
<h3>The Solution<a class="headerlink" href="#the-solution" title="Link to this heading">¶</a></h3>
<p>The UDP checksum is calculated <em>once</em> at the source and remains untouched for the entire duration of the packet’s life.</p>
<ul class="simple">
<li><p>It seals the <strong>IPs (Pseudo-Header)</strong> AND the <strong>Data (Payload)</strong> together.</p></li>
<li><p>If a router corrupts the data in transit, the final UDP Checksum verification at the destination will fail, even if the Ethernet CRC says “the last wire jump was fine.”</p></li>
</ul>
</section>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="logical_addressing.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Logical Addressing (IPv4)</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="../hardware/index.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Hardware</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Mahad Ibrahim</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/Mahad-Ibrahim" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../../_static/shibuya.js?v=cac61aee"></script>
      <script defer="defer" src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
      <script defer="defer" src="../../_static/js/smooth_scroll.js?v=5f731fdf"></script></body>
</html>